{"is_source_file": true, "format": "Python", "description": "This file contains database utility functions for a music player backend, including environment-based URL configuration, URL normalization and redaction for logging, session management, and error handling for database operations using SQLAlchemy. It defines functions for creating and managing database engine and sessions, tailored for a FastAPI application.", "external_files": ["fastapi", "sqlalchemy", "sqlalchemy.engine", "sqlalchemy.exc", "sqlalchemy.orm", "os", "urllib.parse", "contextlib"], "external_methods": ["create_engine", "sessionmaker", "HTTPException", "urlparse", "urlunparse"], "published": ["get_engine", "get_db_session", "db_session_dep"], "classes": [], "methods": [{"name": "str _redact_sqlalchemy_url(url: str)", "description": "Redacts the password from a SQLAlchemy URL for secure logging purposes.", "scope": "", "scopeKind": ""}, {"name": "str _normalize_sqlalchemy_database_url(database_url: str)", "description": "Adjusts the database URL to conform to SQLAlchemy expectations, specifically replacing 'postgres://' with 'postgresql://'.", "scope": "", "scopeKind": ""}, {"name": "str _build_database_url()", "description": "Constructs the database URL from environment variables, supporting multiple configuration strategies, with validation checks.", "scope": "", "scopeKind": ""}, {"name": "Engine get_engine()", "description": "Lazily initializes and returns the SQLAlchemy engine for database interactions, handling URL creation and logging.", "scope": "", "scopeKind": ""}, {"name": "Generator[Session,None,None] get_db_session()", "description": "Context manager that provides a SQLAlchemy session with automatic commit/rollback and proper cleanup.", "scope": "", "scopeKind": ""}, {"name": "Generator[Session,None,None] db_session_dep()", "description": "FastAPI dependency that supplies a database session with error handling, providing user-friendly HTTP error responses.", "scope": "", "scopeKind": ""}], "calls": ["create_engine", "sessionmaker", "get_engine", "get_db_session", "HTTPException", "urlparse", "urlunparse"], "search-terms": ["database_url", "SQLAlchemy", "connection", "session", "FastAPI dependency", "environment variables", "PostgreSQL", "URL normalization", "URL redaction"], "state": 2, "file_id": 5, "knowledge_revision": 43, "git_revision": "a52484a1bcb22f504e04295d03e5729510155c91", "revision_history": [{"11": ""}, {"24": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}, {"39": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}, {"40": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}, {"41": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}, {"42": "1557003ce32402515df7320065bef2a8083270a7"}, {"43": "a52484a1bcb22f504e04295d03e5729510155c91"}], "ctags": [{"_type": "tag", "name": "_ENGINE", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/db.py", "pattern": "/^_ENGINE: Optional[Engine] = None$/", "language": "Python", "typeref": "typename:Optional[Engine]", "kind": "variable"}, {"_type": "tag", "name": "_SessionLocal", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/db.py", "pattern": "/^_SessionLocal: Optional[sessionmaker] = None$/", "language": "Python", "typeref": "typename:Optional[sessionmaker]", "kind": "variable"}, {"_type": "tag", "name": "_build_database_url", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/db.py", "pattern": "/^def _build_database_url() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_normalize_sqlalchemy_database_url", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/db.py", "pattern": "/^def _normalize_sqlalchemy_database_url(database_url: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(database_url: str)"}, {"_type": "tag", "name": "_redact_sqlalchemy_url", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/db.py", "pattern": "/^def _redact_sqlalchemy_url(url: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(url: str)"}, {"_type": "tag", "name": "db_session_dep", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/db.py", "pattern": "/^def db_session_dep() -> Generator[Session, None, None]:$/", "language": "Python", "typeref": "typename:Generator[Session,None,None]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_db_session", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/db.py", "pattern": "/^def get_db_session() -> Generator[Session, None, None]:$/", "language": "Python", "typeref": "typename:Generator[Session,None,None]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_engine", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/db.py", "pattern": "/^def get_engine() -> Engine:$/", "language": "Python", "typeref": "typename:Engine", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/db.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}], "hash": "bd4f054174044d4d08989ee3373a4006", "format-version": 4, "code-base-name": "music_player_backend", "filename": "music_player_backend/src/api/db.py", "fields": [{"name": "Optional[Engine] _ENGINE", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[sessionmaker] _SessionLocal", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}]}