{"is_source_file": true, "format": "Python", "description": "This file defines API routes for managing songs in a music backend. It includes endpoints for listing, uploading, streaming, and debugging song media paths, with associated media validation, path resolution, and database interactions.", "external_files": ["src.api.db", "src.api.models", "src.api.schemas"], "external_methods": ["db_session_dep", "get_db_session", "select", "desc"], "published": ["list_songs", "upload_song", "stream_song", "stream_song_debug"], "classes": [], "methods": [{"name": "Path _media_root()", "description": "Returns the absolute directory where media files are stored, resolving relative paths against the backend root.", "scope": "", "scopeKind": ""}, {"name": "None _json_404(detail: str)", "description": "Raises a HTTP 404 JSON error with a custom message.", "scope": "", "scopeKind": ""}, {"name": "Path _resolve_song_media_path(song_filename: str)", "description": "Resolves the media file path for a stored song filename, checking absolute paths, media root, and fallback locations.", "scope": "", "scopeKind": ""}, {"name": "int _max_file_bytes()", "description": "Gets the maximum upload size in bytes, configurable via environment variable.", "scope": "", "scopeKind": ""}, {"name": "str _sanitize_filename(name: str)", "description": "Sanitizes filename to contain only safe characters.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,int] _validate_mp3(upload: UploadFile, content: bytes)", "description": "Performs basic validation to ensure uploaded file looks like an MP3 and is within size limits.", "scope": "", "scopeKind": ""}, {"name": "Optional[Tuple[int,int]] _parse_range_header(range_header: str, file_size: int)", "description": "Parses HTTP Range header to extract byte-range for streaming.", "scope": "", "scopeKind": ""}, {"name": "Iterator[bytes] _iter_file_range( path: Path, start: int, end: int, chunk_size: int = 1024 * 1024 )", "description": "Yields chunks of a file for a specified byte range.", "scope": "", "scopeKind": ""}, {"name": "List[SongResponse] list_songs(db: Session = Depends(db_session_dep))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "stream_song(song_id: uuid.UUID, request: Request)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "stream_song_debug(song_id: uuid.UUID)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SongUploadResponse upload_song( file: UploadFile = File(..., description=\"MP3 file upload (multipart/form-data)\"), title: Optional[str] = Form( None, description=\"Optional title. Defaults to original filename stem.\" ), artist: Optional[str] = Form( None, description=\"Optional artist. Defaults to 'Unknown Artist'.\" ), )", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["select", "desc", "raise HTTPException", "Path.write_bytes", "datetime.now", "os.getenv", "uuid.uuid4", "Path.resolve", "Path.is_file", "Path.open", "logger.warning", "logger.info", "os.getcwd", "json_response", "FileResponse"], "search-terms": ["routes_songs", "upload_song", "stream_song", "media_path_resolution", "MP3 upload", "song listing", "public streaming", "path fallback"], "state": 2, "file_id": 9, "knowledge_revision": 69, "git_revision": "5914ea1629e3ae871cf55cbb434024eb0b8dd255", "revision_history": [{"19": ""}, {"26": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}, {"30": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}, {"36": "dc31b44fbebc824c830bff0ac26a3f27b09cc97d"}, {"37": "dc31b44fbebc824c830bff0ac26a3f27b09cc97d"}, {"38": "9b1804294836eb44538238b05c2cb86bb5a1229d"}, {"44": "1557003ce32402515df7320065bef2a8083270a7"}, {"45": "1557003ce32402515df7320065bef2a8083270a7"}, {"46": "715b48aae058172aa91c0fdd1a69bc96c5f5d338"}, {"47": "715b48aae058172aa91c0fdd1a69bc96c5f5d338"}, {"48": "c3b701783fb1f40943ce32766fb215880b33d6f9"}, {"49": "c3b701783fb1f40943ce32766fb215880b33d6f9"}, {"50": "c3b701783fb1f40943ce32766fb215880b33d6f9"}, {"51": "bcbf1acdc4235e940a37c01f26b0cc151e88372d"}, {"52": "81ab8391e989e94d68ed0abbbc50df63a8f99bd4"}, {"53": "81ab8391e989e94d68ed0abbbc50df63a8f99bd4"}, {"54": "d9387ea7eb6b930b8b9505ebe53d4e84f525ac06"}, {"55": "d9387ea7eb6b930b8b9505ebe53d4e84f525ac06"}, {"56": "17c9146855aaca114dba9fdae116f634c0f504ad"}, {"57": "17c9146855aaca114dba9fdae116f634c0f504ad"}, {"58": "2e2c16eaf9627519516e0d0bdf891bd3d880edff"}, {"59": "2e2c16eaf9627519516e0d0bdf891bd3d880edff"}, {"60": "79bddb311991fef8a00460188aa37ffab9c67fed"}, {"61": "79bddb311991fef8a00460188aa37ffab9c67fed"}, {"62": "79bddb311991fef8a00460188aa37ffab9c67fed"}, {"63": "8b4fe4167d8dbfac19273f6f9988aadd1a5405d1"}, {"64": "8b4fe4167d8dbfac19273f6f9988aadd1a5405d1"}, {"67": "8b4fe4167d8dbfac19273f6f9988aadd1a5405d1"}, {"69": "5914ea1629e3ae871cf55cbb434024eb0b8dd255"}], "ctags": [{"_type": "tag", "name": "_BACKEND_ROOT", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^_BACKEND_ROOT = Path(__file__).resolve().parents[2]$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_MAX_FILE_BYTES_DEFAULT", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^_MAX_FILE_BYTES_DEFAULT = 50 * 1024 * 1024  # 50MB$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_iter_file_range", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _iter_file_range($/", "language": "Python", "typeref": "typename:Iterator[bytes]", "kind": "function", "signature": "( path: Path, start: int, end: int, chunk_size: int = 1024 * 1024 )"}, {"_type": "tag", "name": "_json_404", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _json_404(detail: str) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(detail: str)"}, {"_type": "tag", "name": "_max_file_bytes", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _max_file_bytes() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_media_root", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _media_root() -> Path:$/", "language": "Python", "typeref": "typename:Path", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_parse_range_header", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _parse_range_header(range_header: str, file_size: int) -> Optional[Tuple[int, int]]:$/", "language": "Python", "typeref": "typename:Optional[Tuple[int,int]]", "kind": "function", "signature": "(range_header: str, file_size: int)"}, {"_type": "tag", "name": "_resolve_song_media_path", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _resolve_song_media_path(song_filename: str) -> Path:$/", "language": "Python", "typeref": "typename:Path", "kind": "function", "signature": "(song_filename: str)"}, {"_type": "tag", "name": "_sanitize_filename", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _sanitize_filename(name: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_validate_mp3", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _validate_mp3(upload: UploadFile, content: bytes) -> Tuple[str, int]:$/", "language": "Python", "typeref": "typename:Tuple[str,int]", "kind": "function", "signature": "(upload: UploadFile, content: bytes)"}, {"_type": "tag", "name": "list_songs", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def list_songs(db: Session = Depends(db_session_dep)) -> List[SongResponse]:$/", "language": "Python", "typeref": "typename:List[SongResponse]", "kind": "function", "signature": "(db: Session = Depends(db_session_dep))"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^router = APIRouter(tags=[\"Songs\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "stream_song", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def stream_song(song_id: uuid.UUID, request: Request):$/", "language": "Python", "kind": "function", "signature": "(song_id: uuid.UUID, request: Request)"}, {"_type": "tag", "name": "stream_song_debug", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def stream_song_debug(song_id: uuid.UUID):$/", "language": "Python", "kind": "function", "signature": "(song_id: uuid.UUID)"}, {"_type": "tag", "name": "upload_song", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def upload_song($/", "language": "Python", "typeref": "typename:SongUploadResponse", "kind": "function", "signature": "( file: UploadFile = File(..., description=\"MP3 file upload (multipart/form-data)\"), title: Optional[str] = Form( None, description=\"Optional title. Defaults to original filename stem.\" ), artist: Optional[str] = Form( None, description=\"Optional artist. Defaults to 'Unknown Artist'.\" ), )"}], "hash": "d1276c993cbaeba8e157c572fa8558c4", "format-version": 4, "code-base-name": "music_player_backend", "filename": "music_player_backend/src/api/routes_songs.py", "fields": [{"name": "_BACKEND_ROOT = Path(__file__).resolve().parents[2]", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_MAX_FILE_BYTES_DEFAULT = 50 * 1024 * 1024  # 50MB", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(tags=[\"Songs\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}