{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for managing songs in a music library backend. It includes routes for listing all songs, uploading new songs with validation, and streaming songs by ID. It uses FastAPI and SQLAlchemy, and contains functions for handling file storage, validation, and database interactions.", "external_files": ["src.api.db", "src.api.models", "src.api.schemas"], "external_methods": ["db_session_dep", "get_db_session", "Song (constructor/ORM model)"], "published": ["list_songs", "upload_song", "stream_song"], "classes": [], "methods": [{"name": "Path _media_root()", "description": "Determines the directory path where media files are stored, defaulting to a 'media' directory or overridden by environment variable.", "scope": "", "scopeKind": ""}, {"name": "None _json_404(detail: str)", "description": "Raises a HTTP 404 error with a structured JSON detail.", "scope": "", "scopeKind": ""}, {"name": "Path _resolve_song_media_path(song_filename: str)", "description": "Resolves the filesystem path for a song filename, ensuring it stays within the media directory.", "scope": "", "scopeKind": ""}, {"name": "int _max_file_bytes()", "description": "Retrieves the maximum allowed upload size in bytes, configurable via environment variable.", "scope": "", "scopeKind": ""}, {"name": "str _sanitize_filename(name: str)", "description": "Sanitizes a filename string, allowing only safe characters.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,int] _validate_mp3(upload: UploadFile, content: bytes)", "description": "Performs basic validation on uploaded MP3 files, checking content type, extension, size, and header magic.", "scope": "", "scopeKind": ""}, {"name": "List[SongResponse] list_songs(db: Session = Depends(db_session_dep))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "stream_song(song_id: uuid.UUID)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SongUploadResponse upload_song( file: UploadFile = File(..., description=\"MP3 file upload (multipart/form-data)\"), title: Optional[str] = Form(None, description=\"Optional title. Defaults to original filename stem.\"), artist: Optional[str] = Form(None, description=\"Optional artist. Defaults to 'Unknown Artist'.\"), )", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["select", "desc", "Path.resolve", "os.getenv", "re.sub", "raise HTTPException", "uuid.uuid4", "Path.write_bytes", "datetime.now", "get_db_session", "db.add", "db.execute", "db.scalars", "FileResponse"], "search-terms": ["routes_songs", "list_songs", "upload_song", "stream_song", "FastAPI endpoints", "mp3 upload", "public song streaming", "media storage", "SQLAlchemy Song model"], "state": 2, "file_id": 9, "knowledge_revision": 45, "git_revision": "1557003ce32402515df7320065bef2a8083270a7", "revision_history": [{"19": ""}, {"26": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}, {"30": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}, {"36": "dc31b44fbebc824c830bff0ac26a3f27b09cc97d"}, {"37": "dc31b44fbebc824c830bff0ac26a3f27b09cc97d"}, {"38": "9b1804294836eb44538238b05c2cb86bb5a1229d"}, {"44": "1557003ce32402515df7320065bef2a8083270a7"}, {"45": "1557003ce32402515df7320065bef2a8083270a7"}], "ctags": [{"_type": "tag", "name": "_MAX_FILE_BYTES_DEFAULT", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^_MAX_FILE_BYTES_DEFAULT = 50 * 1024 * 1024  # 50MB$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_json_404", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _json_404(detail: str) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(detail: str)"}, {"_type": "tag", "name": "_max_file_bytes", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _max_file_bytes() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_media_root", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _media_root() -> Path:$/", "language": "Python", "typeref": "typename:Path", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_resolve_song_media_path", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _resolve_song_media_path(song_filename: str) -> Path:$/", "language": "Python", "typeref": "typename:Path", "kind": "function", "signature": "(song_filename: str)"}, {"_type": "tag", "name": "_sanitize_filename", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _sanitize_filename(name: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_validate_mp3", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _validate_mp3(upload: UploadFile, content: bytes) -> Tuple[str, int]:$/", "language": "Python", "typeref": "typename:Tuple[str,int]", "kind": "function", "signature": "(upload: UploadFile, content: bytes)"}, {"_type": "tag", "name": "list_songs", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def list_songs(db: Session = Depends(db_session_dep)) -> List[SongResponse]:$/", "language": "Python", "typeref": "typename:List[SongResponse]", "kind": "function", "signature": "(db: Session = Depends(db_session_dep))"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^router = APIRouter(tags=[\"Songs\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "stream_song", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def stream_song(song_id: uuid.UUID):$/", "language": "Python", "kind": "function", "signature": "(song_id: uuid.UUID)"}, {"_type": "tag", "name": "upload_song", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def upload_song($/", "language": "Python", "typeref": "typename:SongUploadResponse", "kind": "function", "signature": "( file: UploadFile = File(..., description=\"MP3 file upload (multipart/form-data)\"), title: Optional[str] = Form(None, description=\"Optional title. Defaults to original filename stem.\"), artist: Optional[str] = Form(None, description=\"Optional artist. Defaults to 'Unknown Artist'.\"), )"}], "hash": "f1610e88afa228503d9dbcae841f29a0", "format-version": 4, "code-base-name": "music_player_backend", "filename": "music_player_backend/src/api/routes_songs.py", "fields": [{"name": "_MAX_FILE_BYTES_DEFAULT = 50 * 1024 * 1024  # 50MB", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(tags=[\"Songs\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}