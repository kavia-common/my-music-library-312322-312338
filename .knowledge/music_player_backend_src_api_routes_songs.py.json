{"is_source_file": true, "format": "Python", "description": "This Python script defines API endpoints for managing 'songs' in a music library backend. It includes functionalities for listing all songs, uploading new songs with validation, and streaming songs by ID. The code also contains utility functions for media path resolution, validation, and environment configuration, and uses FastAPI, SQLAlchemy, and Starlette for web and database operations.", "external_files": ["src/api/db", "src/api/models", "src/api/schemas"], "external_methods": ["db_session_dep", "get_db_session", "Song"], "published": ["list_songs", "upload_song", "stream_song"], "classes": [], "methods": [{"name": "Path _media_root()", "description": "Determines and returns the absolute path to the media storage directory, based on environment variables and project structure.", "scope": "", "scopeKind": ""}, {"name": "None _json_404(detail: str)", "description": "Raises an HTTP 404 exception with a JSON-formatted error message.", "scope": "", "scopeKind": ""}, {"name": "Path _resolve_song_media_path(song_filename: str)", "description": "Resolves the filesystem path for a song filename, ensuring security and correctness.", "scope": "", "scopeKind": ""}, {"name": "int _max_file_bytes()", "description": "Retrieves the maximum allowed upload size in bytes, configurable via environment variables.", "scope": "", "scopeKind": ""}, {"name": "str _sanitize_filename(name: str)", "description": "Sanitizes a filename string to prevent directory traversal and unsafe characters.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,int] _validate_mp3(upload: UploadFile, content: bytes)", "description": "Performs basic validation on an uploaded MP3 file, including content type, extension, and minimal header checks.", "scope": "", "scopeKind": ""}, {"name": "List[SongResponse] list_songs(db: Session = Depends(db_session_dep))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "stream_song(song_id: uuid.UUID)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SongUploadResponse upload_song( file: UploadFile = File(..., description=\"MP3 file upload (multipart/form-data)\"), title: Optional[str] = Form(None, description=\"Optional title. Defaults to original filename stem.\"), artist: Optional[str] = Form(None, description=\"Optional artist. Defaults to 'Unknown Artist'.\"), )", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["select", "desc", "get_db_session", "Path.resolve", "os.getenv", "Path.is_absolute", "Path.write_bytes", "datetime.now", "FileResponse", "raise HTTPException"], "search-terms": ["routes_songs", "upload_song", "stream_song", "list_songs", "APIRouter", "music_player_backend"], "state": 2, "file_id": 9, "knowledge_revision": 50, "git_revision": "c3b701783fb1f40943ce32766fb215880b33d6f9", "revision_history": [{"19": ""}, {"26": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}, {"30": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}, {"36": "dc31b44fbebc824c830bff0ac26a3f27b09cc97d"}, {"37": "dc31b44fbebc824c830bff0ac26a3f27b09cc97d"}, {"38": "9b1804294836eb44538238b05c2cb86bb5a1229d"}, {"44": "1557003ce32402515df7320065bef2a8083270a7"}, {"45": "1557003ce32402515df7320065bef2a8083270a7"}, {"46": "715b48aae058172aa91c0fdd1a69bc96c5f5d338"}, {"47": "715b48aae058172aa91c0fdd1a69bc96c5f5d338"}, {"48": "c3b701783fb1f40943ce32766fb215880b33d6f9"}, {"49": "c3b701783fb1f40943ce32766fb215880b33d6f9"}, {"50": "c3b701783fb1f40943ce32766fb215880b33d6f9"}], "ctags": [{"_type": "tag", "name": "_BACKEND_ROOT", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^_BACKEND_ROOT = Path(__file__).resolve().parents[2]$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_MAX_FILE_BYTES_DEFAULT", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^_MAX_FILE_BYTES_DEFAULT = 50 * 1024 * 1024  # 50MB$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_json_404", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _json_404(detail: str) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(detail: str)"}, {"_type": "tag", "name": "_max_file_bytes", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _max_file_bytes() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_media_root", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _media_root() -> Path:$/", "language": "Python", "typeref": "typename:Path", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_resolve_song_media_path", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _resolve_song_media_path(song_filename: str) -> Path:$/", "language": "Python", "typeref": "typename:Path", "kind": "function", "signature": "(song_filename: str)"}, {"_type": "tag", "name": "_sanitize_filename", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _sanitize_filename(name: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_validate_mp3", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _validate_mp3(upload: UploadFile, content: bytes) -> Tuple[str, int]:$/", "language": "Python", "typeref": "typename:Tuple[str,int]", "kind": "function", "signature": "(upload: UploadFile, content: bytes)"}, {"_type": "tag", "name": "list_songs", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def list_songs(db: Session = Depends(db_session_dep)) -> List[SongResponse]:$/", "language": "Python", "typeref": "typename:List[SongResponse]", "kind": "function", "signature": "(db: Session = Depends(db_session_dep))"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^router = APIRouter(tags=[\"Songs\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "stream_song", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def stream_song(song_id: uuid.UUID):$/", "language": "Python", "kind": "function", "signature": "(song_id: uuid.UUID)"}, {"_type": "tag", "name": "upload_song", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def upload_song($/", "language": "Python", "typeref": "typename:SongUploadResponse", "kind": "function", "signature": "( file: UploadFile = File(..., description=\"MP3 file upload (multipart/form-data)\"), title: Optional[str] = Form(None, description=\"Optional title. Defaults to original filename stem.\"), artist: Optional[str] = Form(None, description=\"Optional artist. Defaults to 'Unknown Artist'.\"), )"}], "hash": "dc1281b6eaa96890ec82c88688847997", "format-version": 4, "code-base-name": "music_player_backend", "filename": "music_player_backend/src/api/routes_songs.py", "fields": [{"name": "_BACKEND_ROOT = Path(__file__).resolve().parents[2]", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_MAX_FILE_BYTES_DEFAULT = 50 * 1024 * 1024  # 50MB", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(tags=[\"Songs\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}