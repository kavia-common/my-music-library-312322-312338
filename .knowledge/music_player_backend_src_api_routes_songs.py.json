{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for managing songs in a music application backend. It includes routes for listing, uploading, and streaming songs, utilizing FastAPI and SQLAlchemy, and incorporates validation and file handling logic.", "external_files": ["src.api.auth", "src.api.db", "src.api.models", "src.api.schemas"], "external_methods": ["get_current_user", "get_db_session"], "published": ["list_songs", "upload_song", "stream_song"], "classes": [{"name": "SongResponse", "description": "Schema representing song information returned to clients."}, {"name": "SongUploadResponse", "description": "Schema representing the response after a song upload."}], "methods": [{"name": "Path _media_root()", "description": "Returns the directory path where media files are stored.", "scope": "", "scopeKind": ""}, {"name": "int _max_file_bytes()", "description": "Determines the maximum allowed upload size in bytes.", "scope": "", "scopeKind": ""}, {"name": "str _sanitize_filename(name: str)", "description": "Sanitizes filenames to be safe for filesystem storage.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,int] _validate_mp3(upload: UploadFile, content: bytes)", "description": "Performs basic validation checks on an uploaded MP3 file.", "scope": "", "scopeKind": ""}, {"name": "List[SongResponse] list_songs(current_user: User = Depends(get_current_user))", "description": "Endpoint to list current user's songs, ordered by creation date.", "scope": "", "scopeKind": ""}, {"name": "SongUploadResponse upload_song( file: UploadFile = File(..., description=\"MP3 file upload (multipart/form-data)\"), title: Optional[str] = Form(None, description=\"Optional title. Defaults to original filename stem.\"), artist: Optional[str] = Form(None, description=\"Optional artist. Defaults to 'Unknown Artist'.\"), current_user: User = Depends(get_current_user), )", "description": "Endpoint to upload an MP3 file with optional metadata.", "scope": "", "scopeKind": ""}, {"name": "stream_song(song_id: uuid.UUID, current_user: User = Depends(get_current_user))", "description": "Endpoint to securely stream a user's song if they own it.", "scope": "", "scopeKind": ""}], "calls": ["select(Song)", "get_current_user", "get_db_session", "Path.write_bytes", "datetime.now", "FileResponse"], "search-terms": ["routes_songs", "list_songs", "upload_song", "stream_song", "MP3 upload", "FastAPI", "SQLAlchemy", "song metadata", "secure streaming"], "state": 2, "file_id": 9, "knowledge_revision": 26, "git_revision": "b0a125ba70a6bed9574197d27aa72463f70f6a00", "revision_history": [{"19": ""}, {"26": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}], "ctags": [{"_type": "tag", "name": "_MAX_FILE_BYTES_DEFAULT", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^_MAX_FILE_BYTES_DEFAULT = 50 * 1024 * 1024  # 50MB$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_max_file_bytes", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _max_file_bytes() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_media_root", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _media_root() -> Path:$/", "language": "Python", "typeref": "typename:Path", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_sanitize_filename", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _sanitize_filename(name: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_validate_mp3", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _validate_mp3(upload: UploadFile, content: bytes) -> Tuple[str, int]:$/", "language": "Python", "typeref": "typename:Tuple[str,int]", "kind": "function", "signature": "(upload: UploadFile, content: bytes)"}, {"_type": "tag", "name": "list_songs", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def list_songs(current_user: User = Depends(get_current_user)) -> List[SongResponse]:$/", "language": "Python", "typeref": "typename:List[SongResponse]", "kind": "function", "signature": "(current_user: User = Depends(get_current_user))"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^router = APIRouter(tags=[\"Songs\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "stream_song", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def stream_song(song_id: uuid.UUID, current_user: User = Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(song_id: uuid.UUID, current_user: User = Depends(get_current_user))"}, {"_type": "tag", "name": "upload_song", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def upload_song($/", "language": "Python", "typeref": "typename:SongUploadResponse", "kind": "function", "signature": "( file: UploadFile = File(..., description=\"MP3 file upload (multipart/form-data)\"), title: Optional[str] = Form(None, description=\"Optional title. Defaults to original filename stem.\"), artist: Optional[str] = Form(None, description=\"Optional artist. Defaults to 'Unknown Artist'.\"), current_user: User = Depends(get_current_user), )"}], "hash": "ca1b2640096e23272f3ab788b80a66a3", "format-version": 4, "code-base-name": "music_player_backend", "filename": "music_player_backend/src/api/routes_songs.py", "fields": [{"name": "_MAX_FILE_BYTES_DEFAULT = 50 * 1024 * 1024  # 50MB", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(tags=[\"Songs\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}