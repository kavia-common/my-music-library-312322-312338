{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for managing songs in a music library, including listing, uploading, and streaming songs. It uses FastAPI for defining routes and SQLAlchemy for database interactions. The code includes functions for validating MP3 files, storing files on disk, and serving song files via streaming.", "external_files": ["src.api.db", "src.api.models", "src.api.schemas"], "external_methods": ["get_db_session", "select", "desc"], "published": ["list_songs", "upload_song", "stream_song"], "classes": [], "methods": [{"name": "Path _media_root()", "description": "Returns the path to the media directory on disk, configurable via environment variable.", "scope": "", "scopeKind": ""}, {"name": "int _max_file_bytes()", "description": "Returns the maximum upload size in bytes, configurable via environment variable.", "scope": "", "scopeKind": ""}, {"name": "str _sanitize_filename(name: str)", "description": "Sanitizes filenames to prevent security issues by removing unsafe characters.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,int] _validate_mp3(upload: UploadFile, content: bytes)", "description": "Performs basic validation of uploaded MP3 files, checking content type, size, and magic bytes.", "scope": "", "scopeKind": ""}, {"name": "List[SongResponse] list_songs()", "description": "API endpoint to list all songs in the library, ordered by creation time (newest first).", "scope": "", "scopeKind": ""}, {"name": "SongUploadResponse upload_song( file: UploadFile = File(..., description=\"MP3 file upload (multipart/form-data)\"), title: Optional[str] = Form(None, description=\"Optional title. Defaults to original filename stem.\"), artist: Optional[str] = Form(None, description=\"Optional artist. Defaults to 'Unknown Artist'.\"), )", "description": "API endpoint to upload an MP3 file, store it on disk, and save metadata in the database.", "scope": "", "scopeKind": ""}, {"name": "stream_song(song_id: uuid.UUID)", "description": "API endpoint to stream a song file by its unique ID with support for range requests.", "scope": "", "scopeKind": ""}], "calls": ["get_db_session()", "select(Song)", "select(Song).where(Song.id == song_id)", "Path.write_bytes()", "Path.exists()", "FileResponse()"], "search-terms": ["routes_songs", "MP3 upload", "public song streaming", "list all songs", "upload MP3", "stream song", "file validation", "FastAPI routes", "SQLAlchemy song model"], "state": 2, "file_id": 9, "knowledge_revision": 37, "git_revision": "dc31b44fbebc824c830bff0ac26a3f27b09cc97d", "revision_history": [{"19": ""}, {"26": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}, {"30": "b0a125ba70a6bed9574197d27aa72463f70f6a00"}, {"36": "dc31b44fbebc824c830bff0ac26a3f27b09cc97d"}, {"37": "dc31b44fbebc824c830bff0ac26a3f27b09cc97d"}], "ctags": [{"_type": "tag", "name": "_MAX_FILE_BYTES_DEFAULT", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^_MAX_FILE_BYTES_DEFAULT = 50 * 1024 * 1024  # 50MB$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_max_file_bytes", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _max_file_bytes() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_media_root", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _media_root() -> Path:$/", "language": "Python", "typeref": "typename:Path", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_sanitize_filename", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _sanitize_filename(name: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_validate_mp3", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _validate_mp3(upload: UploadFile, content: bytes) -> Tuple[str, int]:$/", "language": "Python", "typeref": "typename:Tuple[str,int]", "kind": "function", "signature": "(upload: UploadFile, content: bytes)"}, {"_type": "tag", "name": "list_songs", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def list_songs() -> List[SongResponse]:$/", "language": "Python", "typeref": "typename:List[SongResponse]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^router = APIRouter(tags=[\"Songs\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "stream_song", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def stream_song(song_id: uuid.UUID):$/", "language": "Python", "kind": "function", "signature": "(song_id: uuid.UUID)"}, {"_type": "tag", "name": "upload_song", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def upload_song($/", "language": "Python", "typeref": "typename:SongUploadResponse", "kind": "function", "signature": "( file: UploadFile = File(..., description=\"MP3 file upload (multipart/form-data)\"), title: Optional[str] = Form(None, description=\"Optional title. Defaults to original filename stem.\"), artist: Optional[str] = Form(None, description=\"Optional artist. Defaults to 'Unknown Artist'.\"), )"}], "hash": "fe5a639342450eb9ce1eda6266f9f68a", "format-version": 4, "code-base-name": "music_player_backend", "filename": "music_player_backend/src/api/routes_songs.py", "fields": [{"name": "_MAX_FILE_BYTES_DEFAULT = 50 * 1024 * 1024  # 50MB", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(tags=[\"Songs\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}