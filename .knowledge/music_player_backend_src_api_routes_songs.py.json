{"is_source_file": true, "format": "Python", "description": "This file defines API routes for managing songs in a music backend service. It includes endpoints for listing user songs, uploading MP3 files with validation, and streaming songs securely. The code uses FastAPI for routing and SQLAlchemy for database interactions, and handles file storage and validation logic.", "external_files": ["src.api.auth", "src.api.db", "src.api.models", "src.api.schemas"], "external_methods": ["get_current_user", "get_db_session", "select", "desc", "Path.mkdir", "Path.write_bytes", "uuid.uuid4", "datetime.now", "FileResponse"], "published": ["list_songs", "upload_song", "stream_song"], "classes": [], "methods": [{"name": "Path _media_root()", "description": "Returns the media storage directory path.", "scope": "", "scopeKind": ""}, {"name": "int _max_file_bytes()", "description": "Gets the maximum allowed upload size from environment variable.", "scope": "", "scopeKind": ""}, {"name": "str _sanitize_filename(name: str)", "description": "Sanitizes filenames to a safe format.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,int] _validate_mp3(upload: UploadFile, content: bytes)", "description": "Performs basic validation of uploaded MP3 files.", "scope": "", "scopeKind": ""}, {"name": "List[SongResponse] list_songs(current_user: User = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "stream_song(song_id: uuid.UUID, current_user: User = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SongUploadResponse upload_song( file: UploadFile = File(..., description=\"MP3 file upload (multipart/form-data)\"), title: Optional[str] = Form(None, description=\"Optional title. Defaults to original filename stem.\"), artist: Optional[str] = Form(None, description=\"Optional artist. Defaults to 'Unknown Artist'.\"), current_user: User = Depends(get_current_user), )", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["get_db_session()", "select(Song)", "desc(Song.created_at)", "Path().mkdir()", "Path().write_bytes()", "uuid.uuid4()", "datetime.now()", "FileResponse()"], "search-terms": ["routes_songs.py", "MP3 upload", "streaming endpoint", "user songs", "file validation"], "state": 2, "file_id": 9, "knowledge_revision": 19, "git_revision": "", "ctags": [{"_type": "tag", "name": "_MAX_FILE_BYTES_DEFAULT", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^_MAX_FILE_BYTES_DEFAULT = 50 * 1024 * 1024  # 50MB$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_max_file_bytes", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _max_file_bytes() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_media_root", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _media_root() -> Path:$/", "language": "Python", "typeref": "typename:Path", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_sanitize_filename", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _sanitize_filename(name: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_validate_mp3", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def _validate_mp3(upload: UploadFile, content: bytes) -> Tuple[str, int]:$/", "language": "Python", "typeref": "typename:Tuple[str,int]", "kind": "function", "signature": "(upload: UploadFile, content: bytes)"}, {"_type": "tag", "name": "list_songs", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def list_songs(current_user: User = Depends(get_current_user)) -> List[SongResponse]:$/", "language": "Python", "typeref": "typename:List[SongResponse]", "kind": "function", "signature": "(current_user: User = Depends(get_current_user))"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^router = APIRouter(tags=[\"Songs\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "stream_song", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def stream_song(song_id: uuid.UUID, current_user: User = Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(song_id: uuid.UUID, current_user: User = Depends(get_current_user))"}, {"_type": "tag", "name": "upload_song", "path": "/home/kavia/workspace/code-generation/my-music-library-312322-312338/music_player_backend/src/api/routes_songs.py", "pattern": "/^def upload_song($/", "language": "Python", "typeref": "typename:SongUploadResponse", "kind": "function", "signature": "( file: UploadFile = File(..., description=\"MP3 file upload (multipart/form-data)\"), title: Optional[str] = Form(None, description=\"Optional title. Defaults to original filename stem.\"), artist: Optional[str] = Form(None, description=\"Optional artist. Defaults to 'Unknown Artist'.\"), current_user: User = Depends(get_current_user), )"}], "hash": "ca9957b9a26d7ed6c0530899ea8d5bfd", "format-version": 4, "code-base-name": "music_player_backend", "filename": "music_player_backend/src/api/routes_songs.py", "fields": [{"name": "_MAX_FILE_BYTES_DEFAULT = 50 * 1024 * 1024  # 50MB", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(tags=[\"Songs\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"19": ""}]}